<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>사용자 업로드</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <div class="container">
    <h1>사용자 업로드</h1>
    <p>엑셀(xlsx) 파일을 선택하고 업로드 모드를 지정하세요.</p>

    <input type="file" id="fileInput" accept=".xlsx" /><br>
    <label for="mode">업로드 방식:</label>
    <select id="mode">
      <option value="add">추가만 (기존 유지)</option>
      <option value="overwrite">덮어쓰기 (기존 ID 덮어씀)</option>
      <option value="replace">전체 대체 (기존 삭제)</option>
    </select><br>
    <button id="uploadBtn">업로드</button>

    <p id="status"></p>
  </div>

  <script type="module">
    import { checkRole, startAutoLogout } from './common.js';
    checkRole('admin');
    startAutoLogout(60);

    document.getElementById('uploadBtn').addEventListener('click', async () => {
      const file = document.getElementById('fileInput').files[0];
      const mode = document.getElementById('mode').value;
      if (!file) {
        alert('파일을 선택하세요.');
        return;
      }

      const formData = new FormData();
      formData.append('file', file);
      formData.append('mode', mode);

      try {
        const response = await fetch('http://localhost:3000/api/upload-users', {
          method: 'POST',
          body: formData
        });

        const result = await response.json();
        document.getElementById('status').textContent = result.message;
      } catch (err) {
        console.error(err);
        document.getElementById('status').textContent = '업로드 중 오류 발생';
      }
    });
  </script>
</body>
</html>
